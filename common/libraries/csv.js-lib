!function(){"use strict";function t(t){var n=typeof t;return"function"===n||"object"===n&&!!t}function n(t){return"string"==typeof t}function e(t){return!isNaN(Number(t))}function i(t){return 0==t||1==t}function r(t){return null==t}function o(t){return null!=t}function c(t,n){return o(t)?t:n}function u(t,n){for(var e=0,i=t.length;i>e&&n(t[e],e)!==!1;e+=1);}function s(t){return"attrs["+t+"]"}function a(t,n){return e(t)?"Number("+s(n)+")":i(t)?"Boolean("+s(n)+" == true)":"String("+s(n)+")"}function l(t,n,e){var i=[];return 2==arguments.length?(t?m(t)?u(n,function(n,e){i.push(t[e]+"("+s(e)+")")}):u(n,function(t,n){i.push(a(t,n))}):u(n,function(t,n){i.push(s(n))}),i="return ["+i.join(",")+"]"):(t?m(t)?u(n,function(n,r){i.push('"'+e[r]+'": '+t[r]+"("+s(r)+")")}):u(n,function(t,n){i.push('"'+e[n]+'": '+a(t,n))}):u(n,function(t,n){i.push('"'+e[n]+'": '+s(n))}),i="return {"+i.join(",")+"}"),new Function("attrs",i)}function f(t,n){var e,i=0;return u(n,function(n){var r,o=n;-1!=h.indexOf(n)&&(o="\\"+o),r=t.match(new RegExp(o,"g")),r&&r.length>i&&(i=r.length,e=n)}),e||n[0]}var h=["|","^"],p=[",",";"," ","|","^"],d=["\r\n","\r","\n"],m=Array.isArray||function(t){return"[object Array]"===toString.call(t)},g=function(){function e(t,e){if(e||(e={}),m(t))this.mode="encode";else{if(!n(t))throw new Error("Incompatible format!");this.mode="parse"}this.data=t,this.options={header:c(e.header,!1),cast:c(e.cast,!0)};var i=e.lineDelimiter||e.line,r=e.cellDelimiter||e.delimiter;this.isParser()?(this.options.lineDelimiter=i||f(this.data,d),this.options.cellDelimiter=r||f(this.data,p),this.data=o(this.data,this.options.lineDelimiter)):this.isEncoder()&&(this.options.lineDelimiter=i||"\r\n",this.options.cellDelimiter=r||",")}function i(t,n,e){t(new n(e))}function o(t,n){return t.slice(-n.length)!=n&&(t+=n),t}function s(e){return m(e)?"array":t(e)?"object":n(e)?"string":r(e)?"null":"primitive"}return e.prototype.set=function(t,n){return this.options[t]=n},e.prototype.isParser=function(){return"parse"==this.mode},e.prototype.isEncoder=function(){return"encode"==this.mode},e.prototype.parse=function(t){function n(){s={escaped:!1,quote:!1,cell:!0}}function e(){g.cell=""}function r(){g.line=[]}function o(t){g.line.push(s.escaped?t.slice(1,-1).replace(/""/g,'"'):t),e(),n()}function c(t){o(t.slice(0,1-p.lineDelimiter.length))}function u(){d?m(d)?(a=l(p.cast,g.line,d),(u=function(){i(t,a,g.line)})()):d=g.line:(a||(a=l(p.cast,g.line)),(u=function(){i(t,a,g.line)})())}if("parse"==this.mode){if(0===this.data.trim().length)return[];var s,a,f,h=this.data,p=this.options,d=p.header,g={cell:"",line:[]};t||(f=[],t=function(t){f.push(t)}),1==p.lineDelimiter.length&&(c=o);var y,v,A,w=h.length,D=p.cellDelimiter.charCodeAt(0),j=p.lineDelimiter.charCodeAt(p.lineDelimiter.length-1);for(n(),y=0,v=0;w>y;y++)A=h.charCodeAt(y),s.cell&&(s.cell=!1,34==A)?s.escaped=!0:s.escaped&&34==A?s.quote=!s.quote:(s.escaped&&s.quote||!s.escaped)&&(A==D?(o(g.cell+h.slice(v,y)),v=y+1):A==j&&(c(g.cell+h.slice(v,y)),v=y+1,u(),r()));return f?f:this}},e.prototype.serialize={object:function(t){var n=this,e=Object.keys(t),i=Array(e.length);return u(e,function(e,r){i[r]=n[s(t[e])](t[e])}),i},array:function(t){var n=this,e=Array(t.length);return u(t,function(t,i){e[i]=n[s(t)](t)}),e},string:function(t){return'"'+String(t).replace(/"/g,'""')+'"'},"null":function(){return""},primitive:function(t){return t}},e.prototype.encode=function(t){function n(t){return t.join(o.cellDelimiter)}if("encode"==this.mode){if(0==this.data.length)return"";var e,i,r=this.data,o=this.options,c=o.header,a=r[0],l=this.serialize,f=0;t||(i=Array(r.length),t=function(t,n){i[n+f]=t}),c&&(m(c)||(e=Object.keys(a),c=e),t(n(l.array(c)),0),f=1);var h,p=s(a);return"array"==p?(m(o.cast)?(h=Array(o.cast.length),u(o.cast,function(t,n){h[n]=t.toLowerCase()})):(h=Array(a.length),u(a,function(t,n){h[n]=s(t)})),u(r,function(e,i){var r=Array(h.length);u(e,function(t,n){r[n]=l[h[n]](t)}),t(n(r),i)})):"object"==p&&(e=Object.keys(a),m(o.cast)?(h=Array(o.cast.length),u(o.cast,function(t,n){h[n]=t.toLowerCase()})):(h=Array(e.length),u(e,function(t,n){h[n]=s(a[t])})),u(r,function(i,r){var o=Array(e.length);u(e,function(t,n){o[n]=l[h[n]](i[t])}),t(n(o),r)})),i?i.join(o.lineDelimiter):this}},e.prototype.forEach=function(t){return this[this.mode](t)},e}();g.parse=function(t,n){return new g(t,n).parse()},g.encode=function(t,n){return new g(t,n).encode()},g.forEach=function(t,n,e){return 2==arguments.length&&(e=n),new g(t,n).forEach(e)},"function"==typeof define&&define.amd?define("CSV",[],function(){return g}):"object"==typeof module&&module.exports?module.exports=g:window&&(window.CSV=g)}();
